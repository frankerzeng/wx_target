define(function(a){return{
/*!
         * WYSIWYG UBB Editor support for xhEditor
         * @requires xhEditor
         *
         * @author Yanis.Wang<yanis.wang@gmail.com>
         * @site http://xheditor.com/
         * @licence LGPL(http://www.opensource.org/licenses/lgpl-license.php)
         *
         * @Version: 0.9.12 (build 120228)
         */
ubb2html:function(f){var c,h=String(f),d=new Array(),b=0;var e=["10px","13px","16px","18px","24px","32px","48px"];h=h.replace(/[<>&"]/g,function(i){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[i]});h=h.replace(/\r?\n/g,"<br />");h=h.replace(/\[code\s*(?:=\s*([^\]]+?))?\]([\s\S]*?)\[\/code\]/ig,function(j,i,k){b++;d[b]=j;return"[\tubbcodeplace_"+b+"\t]"});h=h.replace(/\[(\/?)(b|u|i|s|sup|sub)\]/ig,"<$1$2>");h=h.replace(/\[color\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,'<font color="$1">');h=h.replace(/\[font\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,'<font face="$1">');h=h.replace(/\[\/(color|font)\]/ig,"</font>");h=h.replace(/\[size\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,function(j,i){if(i.match(/^\d+$/)){i=e[i-1]}return'<span style="font-size:'+i+';">'});h=h.replace(/\[back\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,'<span style="background-color:$1;">');h=h.replace(/\[\/(size|back)\]/ig,"</span>");for(c=0;c<3;c++){h=h.replace(/\[align\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\](((?!\[align(?:\s+[^\]]+)?\])[\s\S])*?)\[\/align\]/ig,'<p align="$1">$2</p>')}h=h.replace(/\[img\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/img\]/ig,'<img src="$1" alt="" />');h=h.replace(/\[img\s*=([^,\]]*)(?:\s*,\s*(\d*%?)\s*,\s*(\d*%?)\s*)?(?:,?\s*(\w+))?\s*\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*)?\s*\[\/img\]/ig,function(j,m,p,l,k,o){var n='<img src="'+o+'" alt="'+m+'"',i=k?k:(!g(p)?p:"");if(g(p)){n+=' width="'+p+'"'}if(g(l)){n+=' height="'+l+'"'}if(i){n+=' align="'+i+'"'}n+=" />";return n});h=h.replace(/\[emot\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\/\]/ig,'<img emot="$1" />');h=h.replace(/\[url\]\s*(((?!")[\s\S])*?)(?:"[\s\S]*?)?\s*\[\/url\]/ig,'<a href="$1">$1</a>');h=h.replace(/\[url\s*=\s*([^\]"]+?)(?:\,([\w]*))?(?:"[^\]]*?)?\s*\]\s*([\s\S]*?)\s*\[\/url\]/ig,function(j,i,k,l){k=k?'target="'+k+'"':"";return'<a href="'+i+'" '+k+">"+l+"</a>"});h=h.replace(/\[email\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/email\]/ig,'<a href="mailto:$1">$1</a>');h=h.replace(/\[email\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]\s*([\s\S]+?)\s*\[\/email\]/ig,'<a href="mailto:$1">$2</a>');h=h.replace(/\[quote\]/ig,"<blockquote>");h=h.replace(/\[\/quote\]/ig,"</blockquote>");h=h.replace(/\[flash\s*(?:=\s*(\d+)\s*,\s*(\d+)\s*)?\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/flash\]/ig,function(l,i,k,j){if(!i){i=480}if(!k){k=400}return'<embed type="application/x-shockwave-flash" src="'+j+'" wmode="opaque" quality="high" bgcolor="#ffffff" menu="false" play="true" loop="true" width="'+i+'" height="'+k+'"/>'});h=h.replace(/\[media\s*(?:=\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+)\s*)?)?\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/media\]/ig,function(l,i,k,m,j){if(!i){i=480}if(!k){k=400}return'<embed type="application/x-mplayer2" src="'+j+'" enablecontextmenu="false" autostart="'+(m=="1"?"true":"false")+'" width="'+i+'" height="'+k+'"/>'});h=h.replace(/\[table\s*(?:=\s*(\d{1,4}%?)\s*(?:,\s*([^\]"]+)(?:"[^\]]*?)?)?)?\s*\]/ig,function(k,j,i){var l="<table";if(j){l+=' width="'+j+'"'}if(i){l+=' bgcolor="'+i+'"'}return l+">"});h=h.replace(/\[tr\s*(?:=\s*([^\]"]+?)(?:"[^\]]*?)?)?\s*\]/ig,function(j,i){return"<tr"+(i?' bgcolor="'+i+'"':"")+">"});h=h.replace(/\[td\s*(?:=\s*(\d{1,2})\s*,\s*(\d{1,2})\s*(?:,\s*(\d{1,4}%?))?)?\s*\]/ig,function(k,j,l,i){return"<td"+(j>1?' colspan="'+j+'"':"")+(l>1?' rowspan="'+l+'"':"")+(i?' width="'+i+'"':"")+">"});h=h.replace(/\[\/(table|tr|td)\]/ig,"</$1>");h=h.replace(/\[\*\]((?:(?!\[\*\]|\[\/list\]|\[list\s*(?:=[^\]]+)?\])[\s\S])+)/ig,"<li>$1</li>");h=h.replace(/\[list\s*(?:=\s*([^\]"]+?)(?:"[^\]]*?)?)?\s*\]/ig,function(j,i){var k="<ul";if(i){k+=' type="'+i+'"'}return k+">"});h=h.replace(/\[\/list\]/ig,"</ul>");h=h.replace(/\[hr\/\]/ig,"<hr />");for(c=1;c<=b;c++){h=h.replace("[\tubbcodeplace_"+c+"\t]",d[c])}h=h.replace(/(^|<\/?\w+(?:\s+[^>]*?)?>)([^<$]+)/ig,function(j,i,k){return i+k.replace(/[\t ]/g,function(l){return{"\t":"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"," ":"&nbsp;"}[l]})});function g(i){if(i!=null&&i!=""){return !isNaN(i)}else{return false}}return h},html2ubb:function(l){var c=/\s+src\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i,j=/\s+width\s*=\s*(["']?)\s*(\d+(?:\.\d+)?%?)\s*\1(\s|$)/i,b=/\s+height\s*=\s*(["']?)\s*(\d+(?:\.\d+)?%?)\s*\1(\s|$)/i,h=/(?:background|background-color|bgcolor)\s*[:=]\s*(["']?)\s*((rgb\s*\(\s*\d{1,3}%?,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*\))|(#[0-9a-f]{3,6})|([a-z]{1,20}))\s*\1/i;var d,f=String(l),k=new Array(),e=0;f=f.replace(/[ \t]*\r?\n[ \t]*/g,"");f=f.replace(/<(script|style)(\s+[^>]*?)?>[\s\S]*?<\/\1>/ig,"");f=f.replace(/<!--[\s\S]*?-->/ig,"");f=f.replace(/<br(\s+[^>]*)?\/?>/ig,"\r\n");f=f.replace(/\[code\s*(=\s*([^\]]+?))?\]([\s\S]*?)\[\/code\]/ig,function(o,i,p){e++;k[e]=o;return"[\tubbcodeplace_"+e+"\t]"});f=f.replace(/<(\/?)(b|u|i|s)(\s+[^>]*?)?>/ig,"[$1$2]");f=f.replace(/<(\/?)strong(\s+[^>]*?)?>/ig,"[$1b]");f=f.replace(/<(\/?)em(\s+[^>]*?)?>/ig,"[$1i]");f=f.replace(/<(\/?)(strike|del)(\s+[^>]*?)?>/ig,"[$1s]");f=f.replace(/<(\/?)(sup|sub)(\s+[^>]*?)?>/ig,"[$1$2]");function g(s,i,r,t){if(!r){return t}var q=[],o=[];var p;p=r.match(/ face\s*=\s*"\s*([^"]+)\s*"/i);if(p){q.push("[font="+p[1]+"]");o.push("[/font]")}p=r.match(/ size\s*=\s*"\s*(\d+)\s*"/i);if(p){q.push("[size="+p[1]+"]");o.push("[/size]")}p=r.match(/ color\s*=\s*"\s*([^"]+)\s*"/i);if(p){q.push("[color="+n(p[1])+"]");o.push("[/color]")}return q.join("")+t+o.join("")}f=f.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,g);f=f.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,g);f=f.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,g);for(d=0;d<3;d++){f=f.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*(?:font-family|font-size|color|background|background-color)\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,function(v,x,i,s){var t=i.match(/(?:^|;)\s*font-family\s*:\s*([^;]+)/i),w=i.match(/(?:^|;)\s*font-size\s*:\s*([^;]+)/i),p=i.match(/(?:^|;)\s*color\s*:\s*([^;]+)/i),q=i.match(/(?:^|;)\s*(?:background|background-color)\s*:\s*([^;]+)/i),u=s;var o=[],r=[];if(t){o.push("[font="+t[1]+"]");r.push("[/font]")}if(w){o.push("[size="+w[1]+"]");r.push("[/size]")}if(p){o.push("[color="+n(p[1])+"]");r.push("[/color]")}if(q){o.push("[back="+n(q[1])+"]");r.push("[/back]")}return o.join("")+u+r.join("")})}function n(o){var i;if(i=o.match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i)){o=(i[1]*65536+i[2]*256+i[3]*1).toString(16);while(o.length<6){o="0"+o}o="#"+o}o=o.replace(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3");return o}for(d=0;d<3;d++){f=f.replace(/<(div|p)(?:\s+[^>]*?)?[\s"';]\s*(?:text-)?align\s*[=:]\s*(["']?)\s*(left|center|right)\s*\2[^>]*>(((?!<\1(\s+[^>]*?)?>)[\s\S])+?)<\/\1>/ig,"[align=$3]$4[/align]")}for(d=0;d<3;d++){f=f.replace(/<(center)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,"[align=center]$2[/align]")}for(d=0;d<3;d++){f=f.replace(/<(p|div)(?:\s+[^>]*?)?\s+style\s*=\s*"(?:[^;"]*;)*\s*text-align\s*:([^;"]*)[^"]*"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,function(o,i,q,p){return"[align="+q+"]"+p+"[/align]"})}f=f.replace(/<a([^>]*)>\s*([\s\S]*?)\s*<\/a>/ig,function(q,o,s){var p=o.match(/href=(["'])\s*(.+?)\s*\1/i);var r=o.match(/target=(["'])\s*(.+?)\s*\1/i);var i="url";p=p&&p[2];r=(r&&(","+r[2]))||"";if(p.match(/^mailto:/i)){i="email";p=p.replace(/mailto:(.+?)/i,"$1")}return"["+i+"="+p+r+"]"+s+"[/"+i+"]"});f=f.replace(/<img(\s+[^>]*?)\/?>/ig,function(x,t){var v=t.match(/\s+emot\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i);if(v){return"[emot="+v[2]+"/]"}var i=t.match(c),q=t.match(/\s+alt\s*=\s*(["']?)\s*(.*?)\s*\1(\s|$)/i),y=t.match(j),r=t.match(b),s=t.match(/\s+align\s*=\s*(["']?)\s*(\w+)\s*\1(\s|$)/i),u="[img",o="";if(!i){return""}o+=q[2];if(y||r){o+=","+(y?y[2]:"")+","+(r?r[2]:"")}if(s){o+=","+s[2]}if(o){u+="="+o}u+="]"+i[2]+"[/img]";return u});f=f.replace(/<blockquote(?:\s+[^>]*?)?>/ig,"[quote]");f=f.replace(/<\/blockquote>/ig,"[/quote]");f=f.replace(/<embed((?:\s+[^>]*?)?(?:\s+type\s*=\s*"\s*application\/x-shockwave-flash\s*"|\s+classid\s*=\s*"\s*clsid:d27cdb6e-ae6d-11cf-96b8-4445535400000\s*")[^>]*?)\/?>/ig,function(r,i){var p=i.match(c),o=i.match(j),q=i.match(b),s="[flash";if(!p){return""}if(o&&q){s+="="+o[2]+","+q[2]}s+="]"+p[2];return s+"[/flash]"});f=f.replace(/<embed((?:\s+[^>]*?)?(?:\s+type\s*=\s*"\s*application\/x-mplayer2\s*"|\s+classid\s*=\s*"\s*clsid:6bf52a52-394a-11d3-b153-00c04f79faa6\s*")[^>]*?)\/?>/ig,function(s,i){var q=i.match(c),o=i.match(j),r=i.match(b),t=i.match(/\s+autostart\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i),u="[media",v="0";if(!q){return""}if(t){if(t[2]=="true"){v="1"}}if(o&&r){u+="="+o[2]+","+r[2]+","+v}u+="]"+q[2];return u+"[/media]"});f=f.replace(/<table(\s+[^>]*?)?>/ig,function(q,o){var r="[table";if(o){var p=o.match(j),i=o.match(h);if(p){r+="="+p[2];if(i){r+=","+i[2]}}}return r+"]"});f=f.replace(/<tr(\s+[^>]*?)?>/ig,function(p,i){var q="[tr";if(i){var o=i.match(h);if(o){q+="="+o[2]}}return q+"]"});f=f.replace(/<(?:th|td)(\s+[^>]*?)?>/ig,function(q,i){var s="[td";if(i){var p=i.match(/\s+colspan\s*=\s*(["']?)\s*(\d+)\s*\1(\s|$)/i),r=i.match(/\s+rowspan\s*=\s*(["']?)\s*(\d+)\s*\1(\s|$)/i),o=i.match(j);p=p?p[2]:1;r=r?r[2]:1;if(p>1||r>1||o){s+="="+p+","+r}if(o){s+=","+o[2]}}return s+"]"});f=f.replace(/<\/(table|tr)>/ig,"[/$1]");f=f.replace(/<\/(th|td)>/ig,"[/td]");f=f.replace(/<ul(\s+[^>]*?)?>/ig,function(p,i){var o;if(i){o=i.match(/\s+type\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i)}return"[list"+(o?"="+o[2]:"")+"]"});f=f.replace(/<ol(\s+[^>]*?)?>/ig,"[list=1]");f=f.replace(/<li(\s+[^>]*?)?>/ig,"[*]");f=f.replace(/<\/li>/ig,"");f=f.replace(/<\/(ul|ol)>/ig,"[/list]");f=f.replace(/<h([1-6])(\s+[^>]*?)?>/ig,function(i,o){return"\r\n\r\n[size="+(7-o)+"][b]"});f=f.replace(/<\/h[1-6]>/ig,"[/b][/size]\r\n\r\n");f=f.replace(/<address(\s+[^>]*?)?>/ig,"\r\n[i]");f=f.replace(/<\/address>/ig,"[i]\r\n");f=f.replace(/<hr(\s+[^>]*?)?\/>/ig,"[hr/]");for(d=0;d<3;d++){f=f.replace(/<(p)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,"\r\n\r\n$2\r\n\r\n")}for(d=0;d<3;d++){f=f.replace(/<(div)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,"\r\n$2\r\n")}f=f.replace(/((\s|&nbsp;)*\r?\n){3,}/g,"\r\n\r\n");f=f.replace(/^((\s|&nbsp;)*\r?\n)+/g,"");f=f.replace(/((\s|&nbsp;)*\r?\n)+$/g,"");for(d=1;d<=e;d++){f=f.replace("[\tubbcodeplace_"+d+"\t]",k[d])}f=f.replace(/<[^<>]+?>/g,"");var m={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};f=f.replace(/&(lt|gt|nbsp|amp|quot);/ig,function(o,i){return m[i]});f=f.replace(/\[([a-z]+)(?:=[^\[\]]+)?\]\s*\[\/\1\]/ig,"");return f}}});