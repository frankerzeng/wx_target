/*!
 * WYSIWYG UBB Editor support for xhEditor
 * @requires xhEditor
 * 
 * @author Yanis.Wang<yanis.wang@gmail.com>
 * @site http://xheditor.com/
 * @licence LGPL(http://www.opensource.org/licenses/lgpl-license.php)
 * 
 * @Version: 0.9.12 (build 120228)
 */
function ubb2html(e){var b,g=String(e),c=new Array(),a=0;var d=["10px","13px","16px","18px","24px","32px","48px"];g=g.replace(/[<>&"]/g,function(h){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[h]});g=g.replace(/\r?\n/g,"<br />");g=g.replace(/\[code\s*(?:=\s*([^\]]+?))?\]([\s\S]*?)\[\/code\]/ig,function(i,h,j){a++;c[a]=i;return"[\tubbcodeplace_"+a+"\t]"});g=g.replace(/\[(\/?)(b|u|i|s|sup|sub)\]/ig,"<$1$2>");g=g.replace(/\[color\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,'<font color="$1">');g=g.replace(/\[font\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,'<font face="$1">');g=g.replace(/\[\/(color|font)\]/ig,"</font>");g=g.replace(/\[size\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,function(i,h){if(h.match(/^\d+$/)){h=d[h-1]}return'<span style="font-size:'+h+';">'});g=g.replace(/\[back\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]/ig,'<span style="background-color:$1;">');g=g.replace(/\[\/(size|back)\]/ig,"</span>");for(b=0;b<3;b++){g=g.replace(/\[align\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\](((?!\[align(?:\s+[^\]]+)?\])[\s\S])*?)\[\/align\]/ig,'<p align="$1">$2</p>')}g=g.replace(/\[img\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/img\]/ig,'<img src="$1" alt="" />');g=g.replace(/\[img\s*=([^,\]]*)(?:\s*,\s*(\d*%?)\s*,\s*(\d*%?)\s*)?(?:,?\s*(\w+))?\s*\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*)?\s*\[\/img\]/ig,function(i,l,o,k,j,n){var m='<img src="'+n+'" alt="'+l+'"',h=j?j:(!f(o)?o:"");if(f(o)){m+=' width="'+o+'"'}if(f(k)){m+=' height="'+k+'"'}if(h){m+=' align="'+h+'"'}m+=" />";return m});g=g.replace(/\[emot\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\/\]/ig,'<img emot="$1" />');g=g.replace(/\[url\]\s*(((?!")[\s\S])*?)(?:"[\s\S]*?)?\s*\[\/url\]/ig,'<a href="$1">$1</a>');g=g.replace(/\[url\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]\s*([\s\S]*?)\s*\[\/url\]/ig,'<a href="$1">$2</a>');g=g.replace(/\[email\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/email\]/ig,'<a href="mailto:$1">$1</a>');g=g.replace(/\[email\s*=\s*([^\]"]+?)(?:"[^\]]*?)?\s*\]\s*([\s\S]+?)\s*\[\/email\]/ig,'<a href="mailto:$1">$2</a>');g=g.replace(/\[quote\]/ig,"<blockquote>");g=g.replace(/\[\/quote\]/ig,"</blockquote>");g=g.replace(/\[flash\s*(?:=\s*(\d+)\s*,\s*(\d+)\s*)?\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/flash\]/ig,function(l,i,k,j){if(!i){i=480}if(!k){k=400}return'<embed type="application/x-shockwave-flash" src="'+j+'" wmode="opaque" quality="high" bgcolor="#ffffff" menu="false" play="true" loop="true" width="'+i+'" height="'+k+'"/>'});g=g.replace(/\[media\s*(?:=\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+)\s*)?)?\]\s*(((?!")[\s\S])+?)(?:"[\s\S]*?)?\s*\[\/media\]/ig,function(l,i,k,m,j){if(!i){i=480}if(!k){k=400}return'<embed type="application/x-mplayer2" src="'+j+'" enablecontextmenu="false" autostart="'+(m=="1"?"true":"false")+'" width="'+i+'" height="'+k+'"/>'});g=g.replace(/\[table\s*(?:=\s*(\d{1,4}%?)\s*(?:,\s*([^\]"]+)(?:"[^\]]*?)?)?)?\s*\]/ig,function(j,i,h){var k="<table";if(i){k+=' width="'+i+'"'}if(h){k+=' bgcolor="'+h+'"'}return k+">"});g=g.replace(/\[tr\s*(?:=\s*([^\]"]+?)(?:"[^\]]*?)?)?\s*\]/ig,function(i,h){return"<tr"+(h?' bgcolor="'+h+'"':"")+">"});g=g.replace(/\[td\s*(?:=\s*(\d{1,2})\s*,\s*(\d{1,2})\s*(?:,\s*(\d{1,4}%?))?)?\s*\]/ig,function(j,i,k,h){return"<td"+(i>1?' colspan="'+i+'"':"")+(k>1?' rowspan="'+k+'"':"")+(h?' width="'+h+'"':"")+">"});g=g.replace(/\[\/(table|tr|td)\]/ig,"</$1>");g=g.replace(/\[\*\]((?:(?!\[\*\]|\[\/list\]|\[list\s*(?:=[^\]]+)?\])[\s\S])+)/ig,"<li>$1</li>");g=g.replace(/\[list\s*(?:=\s*([^\]"]+?)(?:"[^\]]*?)?)?\s*\]/ig,function(i,h){var j="<ul";if(h){j+=' type="'+h+'"'}return j+">"});g=g.replace(/\[\/list\]/ig,"</ul>");g=g.replace(/\[hr\/\]/ig,"<hr />");for(b=1;b<=a;b++){g=g.replace("[\tubbcodeplace_"+b+"\t]",c[b])}g=g.replace(/(^|<\/?\w+(?:\s+[^>]*?)?>)([^<$]+)/ig,function(i,h,j){return h+j.replace(/[\t ]/g,function(k){return{"\t":"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"," ":"&nbsp;"}[k]})});function f(h){if(h!=null&&h!=""){return !isNaN(h)}else{return false}}return g}function html2ubb(k){var b=/\s+src\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i,h=/\s+width\s*=\s*(["']?)\s*(\d+(?:\.\d+)?%?)\s*\1(\s|$)/i,a=/\s+height\s*=\s*(["']?)\s*(\d+(?:\.\d+)?%?)\s*\1(\s|$)/i,g=/(?:background|background-color|bgcolor)\s*[:=]\s*(["']?)\s*((rgb\s*\(\s*\d{1,3}%?,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*\))|(#[0-9a-f]{3,6})|([a-z]{1,20}))\s*\1/i;var c,e=String(k),j=new Array(),d=0;e=e.replace(/[ \t]*\r?\n[ \t]*/g,"");e=e.replace(/<(script|style)(\s+[^>]*?)?>[\s\S]*?<\/\1>/ig,"");e=e.replace(/<!--[\s\S]*?-->/ig,"");e=e.replace(/<br(\s+[^>]*)?\/?>/ig,"\r\n");e=e.replace(/\[code\s*(=\s*([^\]]+?))?\]([\s\S]*?)\[\/code\]/ig,function(n,i,o){d++;j[d]=n;return"[\tubbcodeplace_"+d+"\t]"});e=e.replace(/<(\/?)(b|u|i|s)(\s+[^>]*?)?>/ig,"[$1$2]");e=e.replace(/<(\/?)strong(\s+[^>]*?)?>/ig,"[$1b]");e=e.replace(/<(\/?)em(\s+[^>]*?)?>/ig,"[$1i]");e=e.replace(/<(\/?)(strike|del)(\s+[^>]*?)?>/ig,"[$1s]");e=e.replace(/<(\/?)(sup|sub)(\s+[^>]*?)?>/ig,"[$1$2]");function f(r,i,q,s){if(!q){return s}var p=[],n=[];var o;o=q.match(/ face\s*=\s*"\s*([^"]+)\s*"/i);if(o){p.push("[font="+o[1]+"]");n.push("[/font]")}o=q.match(/ size\s*=\s*"\s*(\d+)\s*"/i);if(o){p.push("[size="+o[1]+"]");n.push("[/size]")}o=q.match(/ color\s*=\s*"\s*([^"]+)\s*"/i);if(o){p.push("[color="+m(o[1])+"]");n.push("[/color]")}return p.join("")+s+n.join("")}e=e.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,f);e=e.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?)<\/\1>/ig,f);e=e.replace(/<(font)(\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,f);for(c=0;c<3;c++){e=e.replace(/<(span)(?:\s+[^>]*?)?\s+style\s*=\s*"((?:[^"]*?;)*\s*(?:font-family|font-size|color|background|background-color)\s*:[^"]*)"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,function(u,w,i,r){var s=i.match(/(?:^|;)\s*font-family\s*:\s*([^;]+)/i),v=i.match(/(?:^|;)\s*font-size\s*:\s*([^;]+)/i),o=i.match(/(?:^|;)\s*color\s*:\s*([^;]+)/i),p=i.match(/(?:^|;)\s*(?:background|background-color)\s*:\s*([^;]+)/i),t=r;var n=[],q=[];if(s){n.push("[font="+s[1]+"]");q.push("[/font]")}if(v){n.push("[size="+v[1]+"]");q.push("[/size]")}if(o){n.push("[color="+m(o[1])+"]");q.push("[/color]")}if(p){n.push("[back="+m(p[1])+"]");q.push("[/back]")}return n.join("")+t+q.join("")})}function m(n){var i;if(i=n.match(/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i)){n=(i[1]*65536+i[2]*256+i[3]*1).toString(16);while(n.length<6){n="0"+n}n="#"+n}n=n.replace(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,"#$1$1$2$2$3$3");return n}for(c=0;c<3;c++){e=e.replace(/<(div|p)(?:\s+[^>]*?)?[\s"';]\s*(?:text-)?align\s*[=:]\s*(["']?)\s*(left|center|right)\s*\2[^>]*>(((?!<\1(\s+[^>]*?)?>)[\s\S])+?)<\/\1>/ig,"[align=$3]$4[/align]")}for(c=0;c<3;c++){e=e.replace(/<(center)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S])*?)<\/\1>/ig,"[align=center]$2[/align]")}for(c=0;c<3;c++){e=e.replace(/<(p|div)(?:\s+[^>]*?)?\s+style\s*=\s*"(?:[^;"]*;)*\s*text-align\s*:([^;"]*)[^"]*"(?: [^>]+)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,function(n,i,p,o){return"[align="+p+"]"+o+"[/align]"})}e=e.replace(/<a(?:\s+[^>]*?)?\s+href=(["'])\s*(.+?)\s*\1[^>]*>\s*([\s\S]*?)\s*<\/a>/ig,function(o,p,n,s){if(!(n&&s)){return""}var i="url",r;if(n.match(/^mailto:/i)){i="email";n=n.replace(/mailto:(.+?)/i,"$1")}r="["+i;if(n!=s){r+="="+n}return r+"]"+s+"[/"+i+"]"});e=e.replace(/<img(\s+[^>]*?)\/?>/ig,function(v,s){var u=s.match(/\s+emot\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i);if(u){return"[emot="+u[2]+"/]"}var i=s.match(b),o=s.match(/\s+alt\s*=\s*(["']?)\s*(.*?)\s*\1(\s|$)/i),x=s.match(h),q=s.match(a),r=s.match(/\s+align\s*=\s*(["']?)\s*(\w+)\s*\1(\s|$)/i),t="[img",n="";if(!i){return""}n+=o[2];if(x||q){n+=","+(x?x[2]:"")+","+(q?q[2]:"")}if(r){n+=","+r[2]}if(n){t+="="+n}t+="]"+i[2]+"[/img]";return t});e=e.replace(/<blockquote(?:\s+[^>]*?)?>/ig,"[quote]");e=e.replace(/<\/blockquote>/ig,"[/quote]");e=e.replace(/<embed((?:\s+[^>]*?)?(?:\s+type\s*=\s*"\s*application\/x-shockwave-flash\s*"|\s+classid\s*=\s*"\s*clsid:d27cdb6e-ae6d-11cf-96b8-4445535400000\s*")[^>]*?)\/?>/ig,function(q,i){var o=i.match(b),n=i.match(h),p=i.match(a),r="[flash";if(!o){return""}if(n&&p){r+="="+n[2]+","+p[2]}r+="]"+o[2];return r+"[/flash]"});e=e.replace(/<embed((?:\s+[^>]*?)?(?:\s+type\s*=\s*"\s*application\/x-mplayer2\s*"|\s+classid\s*=\s*"\s*clsid:6bf52a52-394a-11d3-b153-00c04f79faa6\s*")[^>]*?)\/?>/ig,function(r,i){var o=i.match(b),n=i.match(h),q=i.match(a),s=i.match(/\s+autostart\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i),t="[media",u="0";if(!o){return""}if(s){if(s[2]=="true"){u="1"}}if(n&&q){t+="="+n[2]+","+q[2]+","+u}t+="]"+o[2];return t+"[/media]"});e=e.replace(/<table(\s+[^>]*?)?>/ig,function(p,n){var q="[table";if(n){var o=n.match(h),i=n.match(g);if(o){q+="="+o[2];if(i){q+=","+i[2]}}}return q+"]"});e=e.replace(/<tr(\s+[^>]*?)?>/ig,function(o,i){var p="[tr";if(i){var n=i.match(g);if(n){p+="="+n[2]}}return p+"]"});e=e.replace(/<(?:th|td)(\s+[^>]*?)?>/ig,function(p,i){var r="[td";if(i){var o=i.match(/\s+colspan\s*=\s*(["']?)\s*(\d+)\s*\1(\s|$)/i),q=i.match(/\s+rowspan\s*=\s*(["']?)\s*(\d+)\s*\1(\s|$)/i),n=i.match(h);o=o?o[2]:1;q=q?q[2]:1;if(o>1||q>1||n){r+="="+o+","+q}if(n){r+=","+n[2]}}return r+"]"});e=e.replace(/<\/(table|tr)>/ig,"[/$1]");e=e.replace(/<\/(th|td)>/ig,"[/td]");e=e.replace(/<ul(\s+[^>]*?)?>/ig,function(o,i){var n;if(i){n=i.match(/\s+type\s*=\s*(["']?)\s*(.+?)\s*\1(\s|$)/i)}return"[list"+(n?"="+n[2]:"")+"]"});e=e.replace(/<ol(\s+[^>]*?)?>/ig,"[list=1]");e=e.replace(/<li(\s+[^>]*?)?>/ig,"[*]");e=e.replace(/<\/li>/ig,"");e=e.replace(/<\/(ul|ol)>/ig,"[/list]");e=e.replace(/<h([1-6])(\s+[^>]*?)?>/ig,function(i,o){return"\r\n\r\n[size="+(7-o)+"][b]"});e=e.replace(/<\/h[1-6]>/ig,"[/b][/size]\r\n\r\n");e=e.replace(/<address(\s+[^>]*?)?>/ig,"\r\n[i]");e=e.replace(/<\/address>/ig,"[i]\r\n");e=e.replace(/<hr(\s+[^>]*?)?\/>/ig,"[hr/]");for(c=0;c<3;c++){e=e.replace(/<(p)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,"\r\n\r\n$2\r\n\r\n")}for(c=0;c<3;c++){e=e.replace(/<(div)(?:\s+[^>]*?)?>(((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S]|<\1(\s+[^>]*?)?>((?!<\1(\s+[^>]*?)?>)[\s\S])*?<\/\1>)*?<\/\1>)*?)<\/\1>/ig,"\r\n$2\r\n")}e=e.replace(/((\s|&nbsp;)*\r?\n){3,}/g,"\r\n\r\n");e=e.replace(/^((\s|&nbsp;)*\r?\n)+/g,"");e=e.replace(/((\s|&nbsp;)*\r?\n)+$/g,"");for(c=1;c<=d;c++){e=e.replace("[\tubbcodeplace_"+c+"\t]",j[c])}e=e.replace(/<[^<>]+?>/g,"");var l={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};e=e.replace(/&(lt|gt|nbsp|amp|quot);/ig,function(n,i){return l[i]});e=e.replace(/\[([a-z]+)(?:=[^\[\]]+)?\]\s*\[\/\1\]/ig,"");return e};