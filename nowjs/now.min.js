define(function(b){var f=function(){this.cfg={tplCache:{},tpl:"static/tpl/",nowjs:"./static/nowjs/",index:"index.php",check:{},ver:"",defPath:"/static/img/default/"};this._uitest=0;this.time=-1;this._gnd={};this._userVal={};this._sync=true};f.prototype={constructor:f,setSync:function(e){this._sync=e?true:false},tpl:function(i,h,g,m){var q=this,n=q.cfg,k=n.tplCache,p=n.tpl,l=function(r){return r.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/'/g,"\\'").replace(/{#/g,"';s+=").replace(/#}/g,";s+='")},o=function(r){return r.replace(/\r/g,"").replace(/\n/g,"").replace(/'/g,"'")},e=function(v){var t=v.split("<!--#"),r=null,w="";if(t.length>1){w+=l(t[0]);for(var u=1;u<t.length;u++){r=t[u].split("#-->");w+="';"+o(r[0])+"s+='"+l(r[1])}}else{w+=l(v)}w=" var s='"+w+"';return s;";return w},j=function(r){r=r.replace(/\{#end#\}/ig,"<!--# } #-->");r=r.replace(/\{#else#\}/ig,"<!--# } else { #-->");r=r.replace(/\{#else(.*?)#\}/ig,"<!--# } else $1 { #-->");r=r.replace(/\{#if(.*?)#\}/ig,"<!--# if $1{ #-->");r=r.replace(/\{#each\s+(.*?)\s+(.*?)#\}/ig,"<!--# for(var i=0;i<$1.length; i++){ var $2 = $1[i];#-->");return e(r)};if(k[i]){g(k[i](h,b));q.imgDefault()}else{if(q._uitest===1){m=false}else{if(m===undefined){m=true}}$.ajax({url:p+i+".html?v="+new Date().getTime(),type:"GET",async:m,success:function(r){k[i]=new Function(["data","require"],j(r));g(k[i](h,b));q.imgDefault()}})}},imgDefault:function(){var e=this;setTimeout(function(){$("img._defimg").each(function(){var g=$(this).attr("src");if(g===""||g==="/"){var h=$(this).attr("_imgname");if(h===undefined){h="user_default_50.jpg"}$(this).attr("src",e.cfg.defPath+h)}})},1000)},pDate:function(h,e,l){if(e===undefined){e=2}if(l===undefined){l=14}var m=(this.time>-1)?this.time:new Date().getTime();var i=new Date(h.replace(/-/g,"/")),k=(m-i.getTime()),j=(k<0),n=Math.abs(k)/1000,g=Math.floor(n/86400);if(j){if(isNaN(g)||g>=31){return h.substr(e,l)}return g===0&&(n<60&&"一会"||n<120&&"1分钟后"||n<3600&&Math.floor(n/60)+"分钟后"||n<7200&&"1小时后"||n<86400&&Math.floor(n/3600)+"小时后")||g===1&&"明天"||g<7&&g+"天后"||g<31&&Math.ceil(g/7)+"周后"}else{if(isNaN(g)||g>=31){return h.substr(e,l)}return g===0&&(n<60&&"刚刚"||n<120&&"1分钟前"||n<3600&&Math.floor(n/60)+"分钟前"||n<7200&&"1小时前"||n<86400&&Math.floor(n/3600)+"小时前")||g===1&&"昨天"||g<7&&g+"天前"||g<31&&Math.ceil(g/7)+"周前"}},uniqid:function(){return""+(new Date()).getTime()+parseInt(Math.random()*100000)},pStr:function(h,g,e){if(h.length<g){return h}if(e===undefined){e="..."}return h.substr(0,g)+e},timeStr:function(i,h){if(i<10){return""}var g=new Date(parseInt(i)*1000),e=function(j){return(j<10)?"0"+j:j};if(h=="time"){return e(g.getHours())+":"+e(g.getMinutes())}if(h){return g.getFullYear()+"-"+(e(g.getMonth()+1))+"-"+e(g.getDate())}else{return g.getFullYear()+"-"+(e(g.getMonth()+1))+"-"+e(g.getDate())+" "+e(g.getHours())+":"+e(g.getMinutes())+":"+e(g.getSeconds())}},intToTime:function(g){if(g<0){return""}var e=function(h){return(h<10)?"0"+h:h};return e(parseInt(g/60/60))+":"+e(parseInt(g/60%60))+":"+e(g%60)},dayWeek:function(e){return new Date(parseInt(e)*1000).getDay()},secToTime:function(j,e){if(j>86400){return""}var k=0,h=0,i=0;k=parseInt(j/3600);h=parseInt((j%3600)/60);i=parseInt((j%3600)%60);if(k<10){k="0"+k}if(h<10){h="0"+h}if(i<10){i="0"+i}var g="";if(e!==undefined&&e===true){g=k+":"+h+":"+i}else{g=k+":"+h}return g},dateadd:function(i,j){var h=function(k){return(k<10)?"0"+k:k};var e=i.split("-");i=new Date(e[0],e[1]-1,e[2]);var g=i.getTime();g=g+j*24*60*60*1000;g=new Date(g);return g.getFullYear()+"-"+(h(g.getMonth()+1))+"-"+h(g.getDate())},datenow:function(){var g=function(h){return(h<10)?"0"+h:h};var e=new Date();return e.getFullYear()+"-"+(g(e.getMonth()+1))+"-"+g(e.getDate())},date2Ts:function(e){var h=e.split(" ",2);var i=(h[0]?h[0]:"").split("-",3);var g=(h[1]?h[1]:"").split(":",3);return(new Date(parseInt(i[0])||null,(parseInt(i[1])||1)-1,parseInt(i[2])||null,parseInt(g[0])||null,parseInt(g[1])||null,parseInt(g[2])||null)).getTime()/1000},getInfoByIdCard:function(h){if(h===""){return false}else{if(h.length!==15&&h.length!==18){return false}}var e="",g="",i={};i.province=this.cfg.pz.jg[h.substr(0,2)+"0000"];i.city=this.cfg.pz.jg[h.substr(0,4)+"00"];i.area=this.cfg.pz.jg[h.substr(0,6)];if(h.length===15){e=h.substring(6,12);e="19"+e;i.birthday=e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6);g=14}else{e=h.substring(6,14);i.birthday=e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6);g=16}if(parseInt(h.substr(g,1))%2==1){i.sex="男"}else{i.sex="女"}return i},getAreaByCode:function(h){if(h.length!==6){return""}if(this.cfg.pz===undefined){$.actMsg("请先配置now.cfg.pz");return""}var e=h.substr(0,2)+"0000";var i=h.substr(2,4)==="0000"?"":h.substr(0,4)+"00";var g=h.substr(4,6)==="00"?"":h;var j="";j=this.cfg.pz.jg[e]?this.cfg.pz.jg[e]:"";j+=this.cfg.pz.jg[i]?this.cfg.pz.jg[i]:"";j+=this.cfg.pz.jg[g]?this.cfg.pz.jg[g]:"";return j},row2map:function(i,g,e){var h={};$.each(i,function(j,k){h[k[g]]=k[e]});return h},addVal:function(g,e){this._userVal[g]=e},getCheckErr:function(e){var j={ip:"IP",phone:"电话",mobile:"手机",tel:"手机或电话",date:"日期格式",idcard:"身份证",zip:"邮编",qq:"QQ号(5-15数字)",url:"网址",mail:"邮箱",uuid:"uuid",timestamp:"时间戳"},h=j[e[0]];if(h){return"请输入正确的"+h}else{var g=function(k){var l="请输入";if(k.length===2){l+=k[1]}else{l+=k[1]+"到"+k[2]}return l};switch(e[0]){case"reg":return"不符合验证规则";case"cmp":if($("label[for="+e[1]+"]").length>0){var i=$("label[for="+e[1]+"]").text();i=i.replace("*","");i=i.replace(":","");i=i.replace("：","");return"请与"+i+"的值保持一致"}return"1";case"alpha":return g(e)+"个字母";case"num":return g(e)+"个数字";case"alnum":return g(e)+"个数字或字母";case"alnum1":return g(e)+"个数字或字母，并以字母开头";case"account":return g(e)+"个只包含数字、字母、下划线、@符号、点号的字符";case"str":return g(e)+"个字符";case"str2":return g(e)+"个字符（一个汉字2字符）";case"int":return"请输入"+e[1]+"到"+e[2]+"的数值";case"float":j="请输入"+e[2]+"到"+e[3]+"的数值";if(e[1]!=="0"){j+="最多"+e[1]+"位小数"}return j;case"gt":if($("label[for="+e[1]+"]").length>0){return"必须大于"+$("label[for="+e[1]+"]").text().replace(/[:：]/,"").replace("*","")}return"1";case"gte":if($("label[for="+e[1]+"]").length>0){return"必须大于等于"+$("label[for="+e[1]+"]").text().replace(/[:：]/,"").replace("*","")}return"1";case"lt":if($("label[for="+e[1]+"]").length>0){return"必须小于"+$("label[for="+e[1]+"]").text().replace(/[:：]/,"").replace("*","")}return"1";case"lte":if($("label[for="+e[1]+"]").length>0){return"必须小于等于"+$("label[for="+e[1]+"]").text().replace(/[:：]/,"").replace("*","")}return"1";case"score":j=e[1]+"到"+e[2]+"的精确到1位小数的数字且小数位为0或5";return j;case"time":return"作答时间段格式错误,正确格式为  xx:xx"}}},val:function(g,u){var A=this,E=0,B=function(i,m){if(m.indexOf("-")>0){return i>m}else{return(parseInt(i)>parseInt(m))}},p=function(i,m){if(m.indexOf("-")>0){return i<m}else{return(parseInt(i)<parseInt(m))}},I=function(s,P,i,v){var y=new Date();var m=y.getFullYear();if(v.getFullYear()==s&&(v.getMonth()+1)==parseInt(P)&&v.getDate()==i){var O=m-s;if(O>=10&&O<=80){return true}else{return"年龄要求10到80周岁"}}return false},G=function(v){if(v.length=="15"){var s=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var m=new Array("1","0","X","9","8","7","6","5","4","3","2");var O=0,y;v=v.substr(0,6)+"19"+v.substr(6,v.length-6);for(y=0;y<17;y++){O+=v.substr(y,1)*s[y]}v+=m[O%11];return v}return v},l=function(O){O=G(O);var s=O.length;if(s=="18"){var y=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var m=new Array("1","0","X","9","8","7","6","5","4","3","2");var Q=0,P,v;for(P=0;P<17;P++){Q+=O.substr(P,1)*y[P]}v=m[Q%11];if(v==O.substr(17,1)){return true}return false}return false},z={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"};for(;E<g.length;E++){var L=g[E].split("-");if(L[0]==="must"){if(u===""){return"不能为空"}continue}if(u===""&&L[0]!=="cmp"){continue}var N="",k=A.getCheckErr(L),w,n;if(L.length===3){N=","+L[2]}switch(L[0]){case"ip":if(!/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(u)){return k}continue;case"phone":if(!/^((0[1-9]{3})?(0[12][0-9])?[-])?\d{6,8}$/.test(u)){return k}continue;case"mobile":if(!/(^0?[1][3-9][0-9]{9}$)/.test(u)){return k}continue;case"tel":if(!(/^((0[1-9]{3})?(0[12][0-9])?[-])?\d{6,8}$/.test(u)||/(^0?[1][3-9][0-9]{9}$)/.test(u))){return k}continue;case"date":var H=(L[2]===undefined)?"yyyy-MM-dd":L[2];var C="MM",J="dd",q="yyyy";var j="^"+H.replace(q,"\\d{4}").replace(C,"\\d{2}").replace(J,"\\d{2}")+"$";if(!new RegExp(j).test(u)){return k}var x=u.substr(H.indexOf(q),4)+"/"+u.substr(H.indexOf(C),2)+"/"+u.substr(H.indexOf(J),2);if(isNaN(new Date(x))){return k}continue;case"idcard":if(!/^(\d{14}|\d{17})(\d|[X])$/.test(u)){return k}var o=u.substring(0,2);if(z[o]==undefined){return k}if(!l(u)){return k}if(u.length==18){var M=/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/;var h=u.match(M);var t=h[2],K=h[3],D=h[4],r=new Date(t+"/"+K+"/"+D);if(typeof I(t,K,D,r)!="boolean"){return I(t,K,D,r)}if(!I(t,K,D,r)){return k}}else{var e=/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/;var h=u.match(e);var t="19"+h[2],K=h[3],D=h[4],r=new Date(t+"/"+K+"/"+D);if(typeof I(t,K,D,r)!="boolean"){return I(t,K,D,r)}if(!I(t,K,D,r)){return k}}continue;case"zip":if(!/^\d{6}$/.test(u)){return k}continue;case"qq":if(!/^\d{5,15}$/.test(u)){return k}continue;case"url":if(!/^(http|https|ftp):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i.test(u)){return k}continue;case"mail":if(!/\w{1,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/.test(u)){return k}continue;case"uuid":if(!/^[a-f0-9]{16}$/.test(u)){return k}continue;case"cmp":if(u!==$("#"+L[1]).val()){return k}continue;case"reg":n=new RegExp(L[1]);if(!n.test(u)){return k}continue;case"alpha":n=new RegExp("^[A-Za-z]{"+L[1]+N+"}$");if(!n.test(u)){return k}continue;case"alnum":n=new RegExp("^[A-Za-z0-9]{"+L[1]+N+"}$");if(!n.test(u)){return k}continue;case"alnum1":n=new RegExp("^[A-Za-z][A-Za-z0-9]{"+(L[1]-1)+","+(L[2]-1)+"}$");if(!n.test(u)){return k}continue;case"account":n=new RegExp("^[A-Za-z0-9@._]{"+L[1]+N+"}$");if(!n.test(u)){return k}continue;case"chinese":n=new RegExp("^[\u4e00-\u9fa5]{"+L[1]+N+"}$");if(!n.test(u)){return k}continue;case"int":n=new RegExp("(^[1-9]+[0-9]{0,50}$)|(^0$)");if(!n.test(u)){return"不是正整数"}u=parseInt(u);if(isNaN(u)){return"不是数值类型"}if(u<parseInt(L[1])||u>parseInt(L[2])){return k}continue;case"float":n=new RegExp("^[0-9]+.?[0-9]{0,"+L[1]+"}$");if(!n.test(u)){return k}u=parseFloat(u);if(isNaN(u)){return"不是数值类型"}if(u<parseInt(L[2])||u>parseInt(L[3])){return k}continue;case"timestamp":if(!/^\d{1,11}$/.test(u)){return k}continue;case"num":n=new RegExp("^[-+]?[\\d]{"+L[1]+N+"}$");if(!n.test(u)){return k}continue;case"str":n=new RegExp("^([\\D\\d]){"+L[1]+N+"}$");if(!n.test(u.replace(/\n/g,"**"))){return k}continue;case"str2":u=u.replace(/[^\x00-\xff]/g,"**");n=new RegExp("^([\\D\\d]){"+L[1]+N+"}$");if(!n.test(u)){return k}continue;case"gt":w=$("#"+L[1]).val();if(!B(u,w)){return k}continue;case"gte":w=$("#"+L[1]).val();if(p(u,w)){return k}continue;case"lt":w=$("#"+L[1]).val();if(w===u||B(u,w)){return k}continue;case"lte":w=$("#"+L[1]).val();if(B(u,w)){return k}continue;case"time":var F=/([0-1][0-9]|2[0-3]):([0-5][0-9])$/i;if(!F.test(u)){return k}continue;case"score":n=new RegExp("^[0-9]+(.?(5|0)){0,1}$");if(!n.test(u)){return"必须是数字格式（小数点后一位为0或5）"}u=parseFloat(u);if(isNaN(u)){return"必须是数字格式"}if(u<parseFloat(L[1])||u>parseFloat(L[2])){return k}continue;case"not_special":n=new RegExp("^[A-Za-z0-9_\u4e00-\u9fa5]+$");if(!n.test(u)){return"只能是中文、数字、字母、下划线"}continue;default:if(A._userVal[L[0]]){return A._userVal[L[0]](g[E],u)}continue}}return""},_cmd:function(j,i,e,k,h){var g=this;if($.isFunction(i)){e=i;i={}}if(!$.isFunction(k)){k=function(l){$.alertMsg("出错提示",l)}}i=i||{};i._c=j;if(typeof h!=="boolean"){h=(this._uitest!==1)?this._sync:false}$.ajax({url:this.cfg.index,data:i,type:"POST",async:h,dataType:"json",error:function(n,l,m){if(l==="timeout"){k({_c:"-1000",_m:"连接超时"})}else{if(l==="parsererror"){k({_c:"-1001",_m:"不是正确的json格式"})}else{if(l==="error"){if(n.readyState>0){k({_c:"-1002",_m:"暂时无法连接到服务器，请稍候重试"})}}}}},success:function(m,l,n){if(m){if(m._t){g.time=m._t}}else{console.log("后端没有数据返回")}if(e){e(m)}}})},htmlDecode:function c(g){var e="";if(g.length===0){return""}e=g.replace(/&amp;/g,"&");e=e.replace(/&lt;/g,"<");e=e.replace(/&gt;/g,">");e=e.replace(/&nbsp;/g," ");e=e.replace(/&#39;/g,"'");e=e.replace(/&quot;/g,'"');e=e.replace(/<br>/g,"\n");return e},getQry:function(e){var g=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i");var h=window.location.search.substr(1).match(g);if(h!==null){return window.unescape(h[2])}return null},getSessStr:function(){var e=this.cfg.cookie_name===undefined?"nnss":this.cfg.cookie_name;return this.cookie(e)},cookie:function(i,h,n){if(h===undefined){var j=new RegExp("\\b"+i+"\\b");var m=document.cookie.search(j);var e=m+i.length+1;if(m===-1){return""}var g=document.cookie.indexOf(";",e);if(g===-1){g=document.cookie.length}return window.unescape(document.cookie.substring(e,g))}else{if(h===""){document.cookie=i+"=;expires=Thu, 01-Jan-1970 00:00:01 GMT;path="+this.cfg.cookie_path+";domain="+this.cfg.cookie_domain+";"}else{if(n===undefined){n=1}var l=new Date();l.setTime(l.getTime()+n*24*60*60*1000);document.cookie=i+"="+window.escape(h)+";expires="+l.toGMTString()+";path="+this.cfg.cookie_path+";domain="+this.cfg.cookie_domain+";"}}},removeFun:function(){if(typeof(window._gnd)!=="undefined"){if(typeof(window._gnd.cmd)!=="undefined"){this._cmd(window._gnd.cmd,{},function(g){window._gnd=g.rows;$.each(window._gnd,function(i,j){$("body ."+j).remove()});var h=true;$.each($("body ._operate_td span"),function(i,j){if($.trim($(this).html())!==""){h=false}});if(h){$("body ._operate_td").hide();$("body ._operate").hide()}else{$("body ._operate_td").show();$("body ._operate").show()}})}else{$.each(window._gnd,function(g,h){$("body ."+h).remove()});var e=true;$.each($("body ._operate_td span"),function(g,h){if($.trim($(this).html())!==""){e=false}});if(e){$("body ._operate_td").hide();$("body ._operate").hide()}else{$("body ._operate_td").show();$("body ._operate").show()}}}},getLinkFunc:function(h,g,e,j){if(!j){j=""}var i=$("<a>").addClass(h).attr("href","javascript:;").text(e);$.each(g,function(k,l){i.attr(k,l)});return i[0].outerHTML+j},getLinkStr:function(h,g){if(!g){g=" "}var e="";$.each(h,function(i,k){if(!k[2]){var j=$("<a>").addClass(k[0]).attr("href","javascript:;").text(i);if(k[1]){$.each(k[1],function(l,m){j.attr(l,m)})}e+=j[0].outerHTML+g}else{e+='<span class="mgr-5 mgl-5 '+k[0]+' "><font color="#C0C0C0">'+i+"</font></span>&nbsp;"+g}});return e},insertStr2Cursor:function(e,g){(function(h){h.fn.extend({insertAtCaret:function(k){var n=h(this)[0];if(document.selection){this.focus();var l=document.selection.createRange();l.text=k;this.focus()}else{if(n.selectionStart||n.selectionStart=="0"){var j=n.selectionStart;var i=n.selectionEnd;var m=n.scrollTop;n.value=n.value.substring(0,j)+k+n.value.substring(i,n.value.length);this.focus();n.selectionStart=j+k.length;n.selectionEnd=j+k.length;n.scrollTop=m}else{this.value+=k;this.focus()}}}})})(jQuery);e.insertAtCaret(g)}};var a=new f();if(a.getQry("_uitest")!==null){window.uitest=true;a._uitest=1;if(a.getQry("_record")!==null){$.ajaxSetup({async:false});$.ajax({url:"./static/nowjs/uitest.js",type:"GET",async:false})}try{$("body").append('<script type="text/javascript">$("#_nui_colorpick").modal("hide");setTimeout(function(){$.support.transition = false;},500)<\/script>')}catch(d){}}else{window.uitest=false}return a});